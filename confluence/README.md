# Confluence Quick Start Connector

This package is a utility for connecting Cohere to Confluence, featuring a simple local development setup.

## Limitations

The Confluence connector will search within the space defined in your `.env`, and performs a case-insensitive full-text
search against all text fields Confluence indexes by default.

## Configuration

This connector requires the following environment variables:

```
CONFLUENCE_USER
CONFLUENCE_API_TOKEN
CONFLUENCE_PRODUCT_URL
CONFLUENCE_SPACE_NAME
```

The user and api token combination should be a user email address and an API token pair.
The API token can be generated by logging into Confluence and going
to the API tokens [page](https://id.atlassian.com/manage-profile/security/api-tokens).
The product URL should be the URL for the Confluence wiki, including the https:// scheme.
The space name should be the name of a single space in your wiki.

### Optional Configuration

```
CONFLUENCE_SEARCH_LIMIT
```

This variable can be used to limit the number of results returned by the connector.
By default, the connector will return 10 results.

```
CONFLUENCE_CONNECTOR_API_KEY
```

This variable can be used to set an API key for the connector.

These variables can optionally be put into a `.env` file for development.
A `.env-template` file is provided with all the environment variables that are used by this demo.

## Development

Create a virtual environment and install dependencies with poetry. We recommend using in-project virtual environments:

```bash
  $ poetry config virtualenvs.in-project true
  $ poetry install --no-root
```

To load some test documents into Confluence, this repo provides a `load_data.py` script in `dev/`.

```bash
  $ poetry shell
  $ python dev/load_data.py
```

Next, start up the connector's server:

```bash
  $ poetry run flask --app provider --debug run --port 5000
```

and check with curl to see that everything works:

```bash
  curl --request POST \
    --url http://localhost:5000/search \
    --header 'Content-Type: application/json' \
    --header 'Authorization: Bearer <CONNECTOR_API_KEY>' \
    --data '{
      "query": "BBQ"
    }'
```

Alternatively, load up the Swagger UI and try out the API from a browser: http://localhost:5000/ui/
